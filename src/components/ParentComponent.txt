async function handleAddStudent(studentData) {
  await createLISUser(supabase, {
    firstName: studentData.first_name,
    lastName: studentData.last_name,
    dateOfBirth: studentData.date_of_birth,
    status: studentData.status,
    course: "BSIT",
    faculty: "Technology",
    password: "default123"
  });

  alert("Student added!");
}


async function createLISUser(supabase, { 
  firstName,
  lastName,
  course,
  faculty,
  password,
  dateOfBirth,
  status = "Active"
}) {

  // 1. Generate LIS ID
  const { data: idRes, error: idErr } = await supabase.rpc(
    "generate_lis_id", 
    { course_name: course, faculty }
  );

  if (idErr) throw idErr;

  const idNumber = idRes;
  const fakeEmail = `${idNumber}@lis.local`;

  // 2. Create auth user
  const { data: authUser, error: authErr } =
    await supabase.auth.admin.createUser({
      email: fakeEmail,
      password,
      email_confirm: true,
      user_metadata: { role: "student" }
    });

  if (authErr) throw authErr;

  // 3. Insert profile record
  const { error: profileErr } = await supabase.from("profiles").insert({
    id: authUser.user.id,
    id_number: idNumber,
    first_name: firstName,
    last_name: lastName,
    email: fakeEmail,
    date_of_birth: dateOfBirth,
    status,
    course,
    faculty
  });

  if (profileErr) throw profileErr;

  return { idNumber };
}
